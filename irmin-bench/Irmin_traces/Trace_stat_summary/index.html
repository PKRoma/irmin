<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Trace_stat_summary (irmin-bench.Irmin_traces.Trace_stat_summary)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">irmin-bench</a> &#x00BB; <a href="../index.html">Irmin_traces</a> &#x00BB; Trace_stat_summary</nav><header class="odoc-preamble"><h1>Module <code><span>Irmin_traces.Trace_stat_summary</span></code></h1><p>Conversion of a <code>Stat_trace</code> to a summary that is both pretty-printable and exportable to JSON.</p><p>The main type <code>t</code> here isn't versioned like a <code>Stat_trace.t</code> is.</p><p>Computing a summary may take a long time if the input <code>Stat_trace</code> is long. Count ~1000 commits per second.</p><p>This file is NOT meant to be used from Tezos, as opposed to some other &quot;trace_*&quot; files.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Def"><a href="#module-Def" class="anchor"></a><code><span><span class="keyword">module</span> Def</span><span> = <a href="../Trace_definitions/Stat_trace/index.html">Trace_definitions.Stat_trace</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Conf"><a href="#module-Conf" class="anchor"></a><code><span><span class="keyword">module</span> Conf</span><span> = <a href="../Trace_stat_summary_conf/index.html">Trace_stat_summary_conf</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Utils"><a href="#module-Utils" class="anchor"></a><code><span><span class="keyword">module</span> Utils</span><span> = <a href="../Trace_stat_summary_utils/index.html">Trace_stat_summary_utils</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Vs"><a href="#module-Vs" class="anchor"></a><code><span><span class="keyword">module</span> Vs</span><span> = <a href="../Trace_stat_summary_utils/Variable_summary/index.html">Utils.Variable_summary</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Seq"><a href="#module-Seq" class="anchor"></a><code><span><span class="keyword">module</span> Seq</span><span> = <a href="../Trace_common/Seq/index.html">Trace_common.Seq</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-curve"><a href="#type-curve" class="anchor"></a><code><span><span class="keyword">type</span> curve</span><span> = <a href="../Trace_stat_summary_utils/index.html#type-curve">Utils.curve</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-curve_t"><a href="#val-curve_t" class="anchor"></a><code><span><span class="keyword">val</span> curve_t : <span><a href="../Trace_stat_summary_utils/index.html#type-curve">Utils.curve</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Span"><a href="#module-Span" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Span/index.html">Span</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A stat trace can be chunked into <em>blocks</em>. A <em>blocks</em> is made of 2 phases, first the <em>buildup</em> and then the <em>commit</em>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Watched_node"><a href="#module-Watched_node" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Watched_node/index.html">Watched_node</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-bag_stat"><a href="#type-bag_stat" class="anchor"></a><code><span><span class="keyword">type</span> bag_stat</span><span> = </span><span>{</span></code><ol><li id="type-bag_stat.value_before_commit" class="def record field anchored"><a href="#type-bag_stat.value_before_commit" class="anchor"></a><code><span>value_before_commit : <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>;</span></code></li><li id="type-bag_stat.value_after_commit" class="def record field anchored"><a href="#type-bag_stat.value_after_commit" class="anchor"></a><code><span>value_after_commit : <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>;</span></code></li><li id="type-bag_stat.diff_per_block" class="def record field anchored"><a href="#type-bag_stat.diff_per_block" class="anchor"></a><code><span>diff_per_block : <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>;</span></code></li><li id="type-bag_stat.diff_per_buildup" class="def record field anchored"><a href="#type-bag_stat.diff_per_buildup" class="anchor"></a><code><span>diff_per_buildup : <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>;</span></code></li><li id="type-bag_stat.diff_per_commit" class="def record field anchored"><a href="#type-bag_stat.diff_per_commit" class="anchor"></a><code><span>diff_per_commit : <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Summary of an entry contained in <code>Def.bag_of_stat</code>.</p><p>Properties of such a variables:</p><ul><li>Is sampled before each commit operation.</li><li>Is sampled after each commit operation.</li><li>Is sampled in header.</li><li>Most of these entries are expected to grow linearly, it implies that no smoothing is necessary for the downsampled curve in these cases, and that the histogram is best viewed on a linear scale - as opposed to a log scale. The other entries are summarised using <code>~is_linearly_increasing:false</code>.</li></ul><p>The <code>value_after_commit</code> is initially fed with the value in the header (i.e. the value recorded just before the start of the play).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bag_stat_t"><a href="#val-bag_stat_t" class="anchor"></a><code><span><span class="keyword">val</span> bag_stat_t : <span><a href="#type-bag_stat">bag_stat</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-finds"><a href="#type-finds" class="anchor"></a><code><span><span class="keyword">type</span> finds</span><span> = </span><span>{</span></code><ol><li id="type-finds.total" class="def record field anchored"><a href="#type-finds.total" class="anchor"></a><code><span>total : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-finds.from_staging" class="def record field anchored"><a href="#type-finds.from_staging" class="anchor"></a><code><span>from_staging : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-finds.from_lru" class="def record field anchored"><a href="#type-finds.from_lru" class="anchor"></a><code><span>from_lru : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-finds.from_pack_direct" class="def record field anchored"><a href="#type-finds.from_pack_direct" class="anchor"></a><code><span>from_pack_direct : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-finds.from_pack_indexed" class="def record field anchored"><a href="#type-finds.from_pack_indexed" class="anchor"></a><code><span>from_pack_indexed : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-finds.missing" class="def record field anchored"><a href="#type-finds.missing" class="anchor"></a><code><span>missing : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-finds.cache_miss" class="def record field anchored"><a href="#type-finds.cache_miss" class="anchor"></a><code><span>cache_miss : <a href="#type-bag_stat">bag_stat</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finds_t"><a href="#val-finds_t" class="anchor"></a><code><span><span class="keyword">val</span> finds_t : <span><a href="#type-finds">finds</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-pack"><a href="#type-pack" class="anchor"></a><code><span><span class="keyword">type</span> pack</span><span> = </span><span>{</span></code><ol><li id="type-pack.finds" class="def record field anchored"><a href="#type-pack.finds" class="anchor"></a><code><span>finds : <a href="#type-finds">finds</a>;</span></code></li><li id="type-pack.appended_hashes" class="def record field anchored"><a href="#type-pack.appended_hashes" class="anchor"></a><code><span>appended_hashes : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.appended_offsets" class="def record field anchored"><a href="#type-pack.appended_offsets" class="anchor"></a><code><span>appended_offsets : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_add" class="def record field anchored"><a href="#type-pack.inode_add" class="anchor"></a><code><span>inode_add : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_remove" class="def record field anchored"><a href="#type-pack.inode_remove" class="anchor"></a><code><span>inode_remove : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_of_seq" class="def record field anchored"><a href="#type-pack.inode_of_seq" class="anchor"></a><code><span>inode_of_seq : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_of_raw" class="def record field anchored"><a href="#type-pack.inode_of_raw" class="anchor"></a><code><span>inode_of_raw : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_rec_add" class="def record field anchored"><a href="#type-pack.inode_rec_add" class="anchor"></a><code><span>inode_rec_add : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_rec_remove" class="def record field anchored"><a href="#type-pack.inode_rec_remove" class="anchor"></a><code><span>inode_rec_remove : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_to_binv" class="def record field anchored"><a href="#type-pack.inode_to_binv" class="anchor"></a><code><span>inode_to_binv : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_decode_bin" class="def record field anchored"><a href="#type-pack.inode_decode_bin" class="anchor"></a><code><span>inode_decode_bin : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-pack.inode_encode_bin" class="def record field anchored"><a href="#type-pack.inode_encode_bin" class="anchor"></a><code><span>inode_encode_bin : <a href="#type-bag_stat">bag_stat</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pack_t"><a href="#val-pack_t" class="anchor"></a><code><span><span class="keyword">val</span> pack_t : <span><a href="#type-pack">pack</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span><span class="keyword">type</span> tree</span><span> = </span><span>{</span></code><ol><li id="type-tree.contents_hash" class="def record field anchored"><a href="#type-tree.contents_hash" class="anchor"></a><code><span>contents_hash : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.contents_find" class="def record field anchored"><a href="#type-tree.contents_find" class="anchor"></a><code><span>contents_find : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.contents_add" class="def record field anchored"><a href="#type-tree.contents_add" class="anchor"></a><code><span>contents_add : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_hash" class="def record field anchored"><a href="#type-tree.node_hash" class="anchor"></a><code><span>node_hash : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_mem" class="def record field anchored"><a href="#type-tree.node_mem" class="anchor"></a><code><span>node_mem : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_add" class="def record field anchored"><a href="#type-tree.node_add" class="anchor"></a><code><span>node_add : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_find" class="def record field anchored"><a href="#type-tree.node_find" class="anchor"></a><code><span>node_find : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_val_v" class="def record field anchored"><a href="#type-tree.node_val_v" class="anchor"></a><code><span>node_val_v : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_val_find" class="def record field anchored"><a href="#type-tree.node_val_find" class="anchor"></a><code><span>node_val_find : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-tree.node_val_list" class="def record field anchored"><a href="#type-tree.node_val_list" class="anchor"></a><code><span>node_val_list : <a href="#type-bag_stat">bag_stat</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tree_t"><a href="#val-tree_t" class="anchor"></a><code><span><span class="keyword">val</span> tree_t : <span><a href="#type-tree">tree</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-index"><a href="#type-index" class="anchor"></a><code><span><span class="keyword">type</span> index</span><span> = </span><span>{</span></code><ol><li id="type-index.bytes_read" class="def record field anchored"><a href="#type-index.bytes_read" class="anchor"></a><code><span>bytes_read : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.nb_reads" class="def record field anchored"><a href="#type-index.nb_reads" class="anchor"></a><code><span>nb_reads : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.bytes_written" class="def record field anchored"><a href="#type-index.bytes_written" class="anchor"></a><code><span>bytes_written : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.nb_writes" class="def record field anchored"><a href="#type-index.nb_writes" class="anchor"></a><code><span>nb_writes : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.bytes_both" class="def record field anchored"><a href="#type-index.bytes_both" class="anchor"></a><code><span>bytes_both : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.nb_both" class="def record field anchored"><a href="#type-index.nb_both" class="anchor"></a><code><span>nb_both : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.nb_merge" class="def record field anchored"><a href="#type-index.nb_merge" class="anchor"></a><code><span>nb_merge : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.cumu_data_bytes" class="def record field anchored"><a href="#type-index.cumu_data_bytes" class="anchor"></a><code><span>cumu_data_bytes : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-index.merge_durations" class="def record field anchored"><a href="#type-index.merge_durations" class="anchor"></a><code><span>merge_durations : <span>float list</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-index_t"><a href="#val-index_t" class="anchor"></a><code><span><span class="keyword">val</span> index_t : <span><a href="#type-index">index</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-gc"><a href="#type-gc" class="anchor"></a><code><span><span class="keyword">type</span> gc</span><span> = </span><span>{</span></code><ol><li id="type-gc.minor_words" class="def record field anchored"><a href="#type-gc.minor_words" class="anchor"></a><code><span>minor_words : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.promoted_words" class="def record field anchored"><a href="#type-gc.promoted_words" class="anchor"></a><code><span>promoted_words : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.major_words" class="def record field anchored"><a href="#type-gc.major_words" class="anchor"></a><code><span>major_words : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.minor_collections" class="def record field anchored"><a href="#type-gc.minor_collections" class="anchor"></a><code><span>minor_collections : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.major_collections" class="def record field anchored"><a href="#type-gc.major_collections" class="anchor"></a><code><span>major_collections : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.compactions" class="def record field anchored"><a href="#type-gc.compactions" class="anchor"></a><code><span>compactions : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.major_heap_bytes" class="def record field anchored"><a href="#type-gc.major_heap_bytes" class="anchor"></a><code><span>major_heap_bytes : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-gc.major_heap_top_bytes" class="def record field anchored"><a href="#type-gc.major_heap_top_bytes" class="anchor"></a><code><span>major_heap_top_bytes : <a href="#type-curve">curve</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gc_t"><a href="#val-gc_t" class="anchor"></a><code><span><span class="keyword">val</span> gc_t : <span><a href="#type-gc">gc</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-disk"><a href="#type-disk" class="anchor"></a><code><span><span class="keyword">type</span> disk</span><span> = </span><span>{</span></code><ol><li id="type-disk.index_data" class="def record field anchored"><a href="#type-disk.index_data" class="anchor"></a><code><span>index_data : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-disk.index_log" class="def record field anchored"><a href="#type-disk.index_log" class="anchor"></a><code><span>index_log : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-disk.index_log_async" class="def record field anchored"><a href="#type-disk.index_log_async" class="anchor"></a><code><span>index_log_async : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-disk.store_dict" class="def record field anchored"><a href="#type-disk.store_dict" class="anchor"></a><code><span>store_dict : <a href="#type-bag_stat">bag_stat</a>;</span></code></li><li id="type-disk.store_pack" class="def record field anchored"><a href="#type-disk.store_pack" class="anchor"></a><code><span>store_pack : <a href="#type-bag_stat">bag_stat</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disk_t"><a href="#val-disk_t" class="anchor"></a><code><span><span class="keyword">val</span> disk_t : <span><a href="#type-disk">disk</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-store"><a href="#type-store" class="anchor"></a><code><span><span class="keyword">type</span> store</span><span> = </span><span>{</span></code><ol><li id="type-store.watched_nodes" class="def record field anchored"><a href="#type-store.watched_nodes" class="anchor"></a><code><span>watched_nodes : <a href="Watched_node/index.html#type-map">Watched_node.map</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-store_t"><a href="#val-store_t" class="anchor"></a><code><span><span class="keyword">val</span> store_t : <span><a href="#type-store">store</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.summary_timeofday" class="def record field anchored"><a href="#type-t.summary_timeofday" class="anchor"></a><code><span>summary_timeofday : float;</span></code></li><li id="type-t.summary_hostname" class="def record field anchored"><a href="#type-t.summary_hostname" class="anchor"></a><code><span>summary_hostname : string;</span></code></li><li id="type-t.curves_sample_count" class="def record field anchored"><a href="#type-t.curves_sample_count" class="anchor"></a><code><span>curves_sample_count : int;</span></code></li><li id="type-t.moving_average_half_life_ratio" class="def record field anchored"><a href="#type-t.moving_average_half_life_ratio" class="anchor"></a><code><span>moving_average_half_life_ratio : float;</span></code></li><li id="type-t.config" class="def record field anchored"><a href="#type-t.config" class="anchor"></a><code><span>config : <a href="../Trace_definitions/Stat_trace/index.html#type-config">Def.config</a>;</span></code></li><li id="type-t.hostname" class="def record field anchored"><a href="#type-t.hostname" class="anchor"></a><code><span>hostname : string;</span></code></li><li id="type-t.word_size" class="def record field anchored"><a href="#type-t.word_size" class="anchor"></a><code><span>word_size : int;</span></code></li><li id="type-t.timeofday" class="def record field anchored"><a href="#type-t.timeofday" class="anchor"></a><code><span>timeofday : float;</span></code></li><li id="type-t.timestamp_wall0" class="def record field anchored"><a href="#type-t.timestamp_wall0" class="anchor"></a><code><span>timestamp_wall0 : float;</span></code></li><li id="type-t.timestamp_cpu0" class="def record field anchored"><a href="#type-t.timestamp_cpu0" class="anchor"></a><code><span>timestamp_cpu0 : float;</span></code></li><li id="type-t.elapsed_wall" class="def record field anchored"><a href="#type-t.elapsed_wall" class="anchor"></a><code><span>elapsed_wall : float;</span></code></li><li id="type-t.elapsed_wall_over_blocks" class="def record field anchored"><a href="#type-t.elapsed_wall_over_blocks" class="anchor"></a><code><span>elapsed_wall_over_blocks : <a href="../Trace_stat_summary_utils/index.html#type-curve">Utils.curve</a>;</span></code></li><li id="type-t.elapsed_cpu" class="def record field anchored"><a href="#type-t.elapsed_cpu" class="anchor"></a><code><span>elapsed_cpu : float;</span></code></li><li id="type-t.elapsed_cpu_over_blocks" class="def record field anchored"><a href="#type-t.elapsed_cpu_over_blocks" class="anchor"></a><code><span>elapsed_cpu_over_blocks : <a href="../Trace_stat_summary_utils/index.html#type-curve">Utils.curve</a>;</span></code></li><li id="type-t.op_count" class="def record field anchored"><a href="#type-t.op_count" class="anchor"></a><code><span>op_count : int;</span></code></li><li id="type-t.span" class="def record field anchored"><a href="#type-t.span" class="anchor"></a><code><span>span : <a href="Span/index.html#type-map">Span.map</a>;</span></code></li><li id="type-t.block_count" class="def record field anchored"><a href="#type-t.block_count" class="anchor"></a><code><span>block_count : int;</span></code></li><li id="type-t.cpu_usage" class="def record field anchored"><a href="#type-t.cpu_usage" class="anchor"></a><code><span>cpu_usage : <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>;</span></code></li><li id="type-t.index" class="def record field anchored"><a href="#type-t.index" class="anchor"></a><code><span>index : <a href="#type-index">index</a>;</span></code></li><li id="type-t.pack" class="def record field anchored"><a href="#type-t.pack" class="anchor"></a><code><span>pack : <a href="#type-pack">pack</a>;</span></code></li><li id="type-t.tree" class="def record field anchored"><a href="#type-t.tree" class="anchor"></a><code><span>tree : <a href="#type-tree">tree</a>;</span></code></li><li id="type-t.gc" class="def record field anchored"><a href="#type-t.gc" class="anchor"></a><code><span>gc : <a href="#type-gc">gc</a>;</span></code></li><li id="type-t.disk" class="def record field anchored"><a href="#type-t.disk" class="anchor"></a><code><span>disk : <a href="#type-disk">disk</a>;</span></code></li><li id="type-t.store" class="def record field anchored"><a href="#type-t.store" class="anchor"></a><code><span>store : <a href="#type-store">store</a>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-t"><a href="#val-t" class="anchor"></a><code><span><span class="keyword">val</span> t : <span><a href="#type-t">t</a> <span class="xref-unresolved">Repr</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_vs"><a href="#val-create_vs" class="anchor"></a><code><span><span class="keyword">val</span> create_vs : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">evolution_smoothing</span>:<span>[ <span>`Ema of float * float</span> <span>| `None</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">scale</span>:<span>[ `Linear <span>| `Log</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-acc">Vs.acc</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_vs_exact"><a href="#val-create_vs_exact" class="anchor"></a><code><span><span class="keyword">val</span> create_vs_exact : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-acc">Vs.acc</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_vs_smooth"><a href="#val-create_vs_smooth" class="anchor"></a><code><span><span class="keyword">val</span> create_vs_smooth : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-acc">Vs.acc</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_vs_smooth_log"><a href="#val-create_vs_smooth_log" class="anchor"></a><code><span><span class="keyword">val</span> create_vs_smooth_log : <span>int <span class="arrow">&#45;&gt;</span></span> <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-acc">Vs.acc</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Span_folder"><a href="#module-Span_folder" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Span_folder/index.html">Span_folder</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Accumulator for the <code>span</code> field of <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Bag_stat_folder"><a href="#module-Bag_stat_folder" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Bag_stat_folder/index.html">Bag_stat_folder</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Summary computation for statistics recorded in <code>Def.bag_of_stat</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Store_watched_nodes_folder"><a href="#module-Store_watched_nodes_folder" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Store_watched_nodes_folder/index.html">Store_watched_nodes_folder</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Accumulator for the <code>store</code> field of <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-major_heap_top_bytes_folder"><a href="#val-major_heap_top_bytes_folder" class="anchor"></a><code><span><span class="keyword">val</span> major_heap_top_bytes_folder : 
  <span><span><span class="type-var">'a</span> <a href="../Trace_definitions/Stat_trace/index.html#type-header_base">Def.header_base</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>[&gt; <span>`Commit of <span><span class="type-var">'b</span> <a href="../Trace_definitions/Stat_trace/index.html#type-commit_base">Def.commit_base</a></span></span> ]</span>, <a href="../Trace_stat_summary_utils/Resample/index.html#type-acc">Utils.Resample.acc</a>, <span>float list</span>)</span>
    <a href="../Trace_stat_summary_utils/Parallel_folders/index.html#type-folder">Utils.Parallel_folders.folder</a></span></span></code></div><div class="spec-doc"><p>Build a resampled curve of <code>gc.top_heap_words</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-elapsed_wall_over_blocks_folder"><a href="#val-elapsed_wall_over_blocks_folder" class="anchor"></a><code><span><span class="keyword">val</span> elapsed_wall_over_blocks_folder : 
  <span><span><span class="type-var">'a</span> <a href="../Trace_definitions/Stat_trace/index.html#type-header_base">Def.header_base</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>[&gt; <span>`Commit of <span><span class="type-var">'b</span> <a href="../Trace_definitions/Stat_trace/index.html#type-commit_base">Def.commit_base</a></span></span> ]</span>, <a href="../Trace_stat_summary_utils/Resample/index.html#type-acc">Utils.Resample.acc</a>, <span>float list</span>)</span>
    <a href="../Trace_stat_summary_utils/Parallel_folders/index.html#type-folder">Utils.Parallel_folders.folder</a></span></span></code></div><div class="spec-doc"><p>Build a resampled curve of timestamps.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-elapsed_cpu_over_blocks_folder"><a href="#val-elapsed_cpu_over_blocks_folder" class="anchor"></a><code><span><span class="keyword">val</span> elapsed_cpu_over_blocks_folder : 
  <span><span><span class="type-var">'a</span> <a href="../Trace_definitions/Stat_trace/index.html#type-header_base">Def.header_base</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>[&gt; <span>`Commit of <span><span class="type-var">'b</span> <a href="../Trace_definitions/Stat_trace/index.html#type-commit_base">Def.commit_base</a></span></span> ]</span>, <a href="../Trace_stat_summary_utils/Resample/index.html#type-acc">Utils.Resample.acc</a>, <span>float list</span>)</span>
    <a href="../Trace_stat_summary_utils/Parallel_folders/index.html#type-folder">Utils.Parallel_folders.folder</a></span></span></code></div><div class="spec-doc"><p>Build a resampled curve of timestamps.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge_durations_folder"><a href="#val-merge_durations_folder" class="anchor"></a><code><span><span class="keyword">val</span> merge_durations_folder : 
  <span><span>(<span><a href="../Trace_definitions/Stat_trace/index.html#type-pack">Def.pack</a> <a href="../Trace_definitions/Stat_trace/index.html#type-row_base">Def.row_base</a></span>, <span>float list</span>, <span>float list</span>)</span> <a href="../Trace_stat_summary_utils/Parallel_folders/index.html#type-folder">Utils.Parallel_folders.folder</a></span></span></code></div><div class="spec-doc"><p>Build a list of all the merge durations.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cpu_usage_folder"><a href="#val-cpu_usage_folder" class="anchor"></a><code><span><span class="keyword">val</span> cpu_usage_folder : 
  <span><span><span class="type-var">'a</span> <a href="../Trace_definitions/Stat_trace/index.html#type-header_base">Def.header_base</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>[&gt; <span>`Commit of <span><span class="type-var">'b</span> <a href="../Trace_definitions/Stat_trace/index.html#type-commit_base">Def.commit_base</a></span></span> ]</span>, float * float * <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-acc">Vs.acc</a>, <a href="../Trace_stat_summary_utils/Variable_summary/index.html#type-t">Vs.t</a>)</span>
    <a href="../Trace_stat_summary_utils/Parallel_folders/index.html#type-folder">Utils.Parallel_folders.folder</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-misc_stats_folder"><a href="#val-misc_stats_folder" class="anchor"></a><code><span><span class="keyword">val</span> misc_stats_folder : 
  <span><span><span class="type-var">'a</span> <a href="../Trace_definitions/Stat_trace/index.html#type-header_base">Def.header_base</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>[&gt; <span>`Commit of <span><span class="type-var">'b</span> <a href="../Trace_definitions/Stat_trace/index.html#type-commit_base">Def.commit_base</a></span></span> ]</span>,
    float * float * int,
    float * float * int)</span>
    <a href="../Trace_stat_summary_utils/Parallel_folders/index.html#type-folder">Utils.Parallel_folders.folder</a></span></span></code></div><div class="spec-doc"><p>Substract the first and the last timestamps and count the number of span.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-summarise'"><a href="#val-summarise'" class="anchor"></a><code><span><span class="keyword">val</span> summarise' : <span><span><a href="../Trace_definitions/Stat_trace/index.html#type-pack">Def.pack</a> <a href="../Trace_definitions/Stat_trace/index.html#type-header_base">Def.header_base</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../Trace_definitions/Stat_trace/index.html#type-row">Def.row</a> <a href="../Trace_common/Seq/index.html#type-t">Seq.t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Fold over <code>row_seq</code> and produce the summary.</p><p>Parallel Folders</p><p>Almost all entries in <code>t</code> require to independently fold over the rows of the stat trace, but we want:</p><ul><li>not to fully load the trace in memory,</li><li>not to reread the trace from disk once for each entry,</li><li>this current file to be verbose and simple,</li><li>to have fun with GADTs and avoid mutability.</li></ul><p>All the boilerplate is hidden behind <code>Utils.Parallel_folders</code>, a datastructure that holds all folder functions, takes care of feeding the rows to those folders, and preseves the types.</p><p>In the code below, <code>pf0</code> is the initial parallel folder, before the first accumulation. Each <code>|+ ...</code> statement declares a <code>acc, accumulate, finalise</code> triplet, i.e. a folder.</p><p><code>val acc : acc</code> is the initial empty accumulation of a folder.</p><p><code>val accumulate : acc -&gt; row -&gt; acc</code> needs to be folded over all rows of the stat trace. Calling <code>Parallel_folders.accumulate pf row</code> will feed <code>row</code> to every folders.</p><p><code>val finalise : acc -&gt; v</code> has to be applied on the final <code>acc</code> of a folder in order to produce the final value of that folder - which value is meant to be stored in <code>Trace_stat_summary.t</code>. Calling <code>Parallel_folders.finalise pf</code> will finalise all folders and pass their result to <code>construct</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-summarise"><a href="#val-summarise" class="anchor"></a><code><span><span class="keyword">val</span> summarise : <span><span class="optlabel">?block_count</span>:int <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Turn a stat trace into a summary.</p><p>The number of blocks to consider may be provided in order to truncate the summary.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save_to_json"><a href="#val-save_to_json" class="anchor"></a><code><span><span class="keyword">val</span> save_to_json : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>
