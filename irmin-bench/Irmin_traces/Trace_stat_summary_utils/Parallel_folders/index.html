<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Parallel_folders (irmin-bench.Irmin_traces.Trace_stat_summary_utils.Parallel_folders)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">irmin-bench</a> &#x00BB; <a href="../../index.html">Irmin_traces</a> &#x00BB; <a href="../index.html">Trace_stat_summary_utils</a> &#x00BB; Parallel_folders</nav><header class="odoc-preamble"><h1>Module <code><span>Trace_stat_summary_utils.Parallel_folders</span></code></h1><p>See <code>Trace_stat_summary</code> for an explanation and an example.</p><p>Heavily inspired by the &quot;repr&quot; library.</p><p>Type parameters:</p><ul><li><code>'res</code> is the output of <code>finalise</code>.</li><li><code>'f</code> is the full contructor that creates a <code>'res</code>.</li><li><code>'v</code> is the output of <code>folder.finalise</code>, one parameter of <code>'f</code>.</li><li><code>'rest</code> is <code>'f</code> or <code>'res</code> or somewhere in between.</li><li><code>'acc</code> is the accumulator of one folder.</li><li><code>'row</code> is what needs to be fed to all <code>folder.accumulate</code>.</li></ul><p>Typical use case:</p><pre class="language-ocaml"><code>let pf =
  open_ (fun res_a res_b -&gt; my_constructor res_a res_b)
  |+ folder my_acc_a my_accumulate_a my_finalise_a
  |+ folder my_acc_b my_accumulate_b my_finalise_b
  |&gt; seal
in
let res = my_row_sequence |&gt; Seq.fold_left accumulate pf |&gt; finalise in</code></pre><p>Section 1/3 - Individual folders</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-folder"><a href="#type-folder" class="anchor"></a><code><span><span class="keyword">type</span> <span>('row, 'acc, 'v) folder</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-folder"><a href="#val-folder" class="anchor"></a><code><span><span class="keyword">val</span> folder : 
  <span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'row</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'acc</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'acc</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'v</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'row</span>, <span class="type-var">'acc</span>, <span class="type-var">'v</span>)</span> <a href="#type-folder">folder</a></span></span></code></div><div class="spec-doc"><p>Create one folder to be passed to an open parallel folder using <code>|+</code>.</p></div></div><p>Section 2/3 - Open parallel folder</p><div class="odoc-spec"><div class="spec type anchored" id="type-folders"><a href="#type-folders" class="anchor"></a><code><span><span class="keyword">type</span> <span>('res, 'row, 'v) folders</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-open_t"><a href="#type-open_t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('res, 'row, 'f, 'rest) open_t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_"><a href="#val-open_" class="anchor"></a><code><span><span class="keyword">val</span> open_ : <span><span class="type-var">'f</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>, <span class="type-var">'f</span>, <span class="type-var">'f</span>)</span> <a href="#type-open_t">open_t</a></span></span></code></div><div class="spec-doc"><p>Start building a parallel folder.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-app"><a href="#val-app" class="anchor"></a><code><span><span class="keyword">val</span> app : 
  <span><span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>, <span class="type-var">'f</span>, <span><span class="type-var">'v</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'rest</span>)</span> <a href="#type-open_t">open_t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'row</span>, <span class="type-var">'acc</span>, <span class="type-var">'v</span>)</span> <a href="#type-folder">folder</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>, <span class="type-var">'f</span>, <span class="type-var">'rest</span>)</span> <a href="#type-open_t">open_t</a></span></span></code></div><div class="spec-doc"><p>Add a folder to an open parallel folder.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(|+)"><a href="#val-(|+)" class="anchor"></a><code><span><span class="keyword">val</span> (|+) : 
  <span><span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>, <span class="type-var">'f</span>, <span><span class="type-var">'v</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'rest</span>)</span> <a href="#type-open_t">open_t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'row</span>, <span class="type-var">'acc</span>, <span class="type-var">'v</span>)</span> <a href="#type-folder">folder</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>, <span class="type-var">'f</span>, <span class="type-var">'rest</span>)</span> <a href="#type-open_t">open_t</a></span></span></code></div><div class="spec-doc"><p>Alias for <code>app</code>.</p></div></div><p>Section 3/3 - Closed parallel folder</p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('res, 'row) t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-seal"><a href="#val-seal" class="anchor"></a><code><span><span class="keyword">val</span> seal : <span><span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>, <span class="type-var">'f</span>, <span class="type-var">'res</span>)</span> <a href="#type-open_t">open_t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Stop building a parallel folder.</p><p>Gotcha: It may seal a partially applied <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-accumulate"><a href="#val-accumulate" class="anchor"></a><code><span><span class="keyword">val</span> accumulate : <span><span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'row</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Forward a row to all registered functional folders.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-finalise"><a href="#val-finalise" class="anchor"></a><code><span><span class="keyword">val</span> finalise : <span><span><span>(<span class="type-var">'res</span>, <span class="type-var">'row</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'res</span></span></code></div><div class="spec-doc"><p>Finalise all folders and pass their result to the user-defined function provided to <code>open_</code>.</p></div></div></div></body></html>
